version: v1.0
name: Atlas website
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
execution_time_limit:
  hours: 3
blocks:
  - name: "Atlas website"
    task:
      secrets:
        - name: GITHUB_PAT
      jobs:
        - name: main
          commands:
            - if [ $SEMAPHORE_GIT_BRANCH == "master" ]; then checkout; fi
            - if [ $SEMAPHORE_GIT_BRANCH == "master" ]; then docker pull "brisbanebirdteam/build-env:latest"; fi
            - if [ $SEMAPHORE_GIT_BRANCH == "master" ]; then sudo fallocate -l 1G /swapfile && sudo chmod 600 /swapfile && sudo mkswap /swapfile && sudo swapon /swapfile; fi
            - if [ $SEMAPHORE_GIT_BRANCH == "master" ]; then echo GITHUB_PAT=$GITHUB_PAT >> $HOME/.Renviron; fi
            - if [ $SEMAPHORE_GIT_BRANCH == "master" ]; then make pull_assets; fi
            - if [ $SEMAPHORE_GIT_BRANCH == "master" ]; then make book_website; fi
            - if [ $SEMAPHORE_GIT_BRANCH == "master" ]; then make deploy_book_website; fi
